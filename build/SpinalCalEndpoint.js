"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _spinalCoreConnectorjs_type = require("spinal-core-connectorjs_type");

const {
  dashboardVariables
} = require("spinal-env-viewer-dashboard-standard-service");

class SpinalCalEndpoint {
  constructor(node) {
    this.node = node;

    this.modelToBind = null;
    this.bindProcess = null;
  }

  bindEndpoint(callback) {
    this.node.element.load().then(element => {

      this.modelToBind = new _spinalCoreConnectorjs_type.Model({
        info: this.node.info,
        value: element.currentValue
      });

      this.bindProcess = this.modelToBind.bind(callback);
    }).catch(() => {
      console.log(this.node);
    });
  }

  getCurrentValue() {
    return this.node.element.load().then(element => {
      return element.currentValue.get();
    });
  }

  getRule() {
    return this.node.info.dash_cal_rule ? this.node.info.dash_cal_rule.rule.get() : dashboardVariables.CALCULATION_RULES.average;
  }

  getReference() {
    return this.node.info.dash_cal_rule.ref.get();
  }

  setEndpoint(value) {
    return this.node.element.load().then(element => {
      element.currentValue.set(value);
    });
  }

  unbindEndpoint() {
    this.modelToBind.unbind(this.bindProcess);
  }
}
exports.default = SpinalCalEndpoint;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TcGluYWxDYWxFbmRwb2ludC5qcyJdLCJuYW1lcyI6WyJkYXNoYm9hcmRWYXJpYWJsZXMiLCJyZXF1aXJlIiwiU3BpbmFsQ2FsRW5kcG9pbnQiLCJjb25zdHJ1Y3RvciIsIm5vZGUiLCJtb2RlbFRvQmluZCIsImJpbmRQcm9jZXNzIiwiYmluZEVuZHBvaW50IiwiY2FsbGJhY2siLCJlbGVtZW50IiwibG9hZCIsInRoZW4iLCJNb2RlbCIsImluZm8iLCJ2YWx1ZSIsImN1cnJlbnRWYWx1ZSIsImJpbmQiLCJjYXRjaCIsImNvbnNvbGUiLCJsb2ciLCJnZXRDdXJyZW50VmFsdWUiLCJnZXQiLCJnZXRSdWxlIiwiZGFzaF9jYWxfcnVsZSIsInJ1bGUiLCJDQUxDVUxBVElPTl9SVUxFUyIsImF2ZXJhZ2UiLCJnZXRSZWZlcmVuY2UiLCJyZWYiLCJzZXRFbmRwb2ludCIsInNldCIsInVuYmluZEVuZHBvaW50IiwidW5iaW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7QUFJQSxNQUFNO0FBQ0pBO0FBREksSUFFRkMsUUFBUSw4Q0FBUixDQUZKOztBQUllLE1BQU1DLGlCQUFOLENBQXdCO0FBQ3JDQyxjQUFZQyxJQUFaLEVBQWtCO0FBQ2hCLFNBQUtBLElBQUwsR0FBWUEsSUFBWjs7QUFFQSxTQUFLQyxXQUFMLEdBQW1CLElBQW5CO0FBQ0EsU0FBS0MsV0FBTCxHQUFtQixJQUFuQjtBQUNEOztBQUVEQyxlQUFhQyxRQUFiLEVBQXVCO0FBQ3JCLFNBQUtKLElBQUwsQ0FBVUssT0FBVixDQUFrQkMsSUFBbEIsR0FBeUJDLElBQXpCLENBQThCRixXQUFXOztBQUV2QyxXQUFLSixXQUFMLEdBQW1CLElBQUlPLGlDQUFKLENBQVU7QUFDM0JDLGNBQU0sS0FBS1QsSUFBTCxDQUFVUyxJQURXO0FBRTNCQyxlQUFPTCxRQUFRTTtBQUZZLE9BQVYsQ0FBbkI7O0FBS0EsV0FBS1QsV0FBTCxHQUFtQixLQUFLRCxXQUFMLENBQWlCVyxJQUFqQixDQUFzQlIsUUFBdEIsQ0FBbkI7QUFDRCxLQVJELEVBUUdTLEtBUkgsQ0FRUyxNQUFNO0FBQ2JDLGNBQVFDLEdBQVIsQ0FBWSxLQUFLZixJQUFqQjtBQUNELEtBVkQ7QUFXRDs7QUFFRGdCLG9CQUFrQjtBQUNoQixXQUFPLEtBQUtoQixJQUFMLENBQVVLLE9BQVYsQ0FBa0JDLElBQWxCLEdBQXlCQyxJQUF6QixDQUE4QkYsV0FBVztBQUM5QyxhQUFPQSxRQUFRTSxZQUFSLENBQXFCTSxHQUFyQixFQUFQO0FBQ0QsS0FGTSxDQUFQO0FBR0Q7O0FBRURDLFlBQVU7QUFDUixXQUFPLEtBQUtsQixJQUFMLENBQVVTLElBQVYsQ0FBZVUsYUFBZixHQUNMLEtBQUtuQixJQUFMLENBQVVTLElBQVYsQ0FBZVUsYUFBZixDQUE2QkMsSUFBN0IsQ0FBa0NILEdBQWxDLEVBREssR0FFTHJCLG1CQUFtQnlCLGlCQUFuQixDQUFxQ0MsT0FGdkM7QUFHRDs7QUFFREMsaUJBQWU7QUFDYixXQUFPLEtBQUt2QixJQUFMLENBQVVTLElBQVYsQ0FBZVUsYUFBZixDQUE2QkssR0FBN0IsQ0FBaUNQLEdBQWpDLEVBQVA7QUFDRDs7QUFFRFEsY0FBWWYsS0FBWixFQUFtQjtBQUNqQixXQUFPLEtBQUtWLElBQUwsQ0FBVUssT0FBVixDQUFrQkMsSUFBbEIsR0FBeUJDLElBQXpCLENBQThCRixXQUFXO0FBQzlDQSxjQUFRTSxZQUFSLENBQXFCZSxHQUFyQixDQUF5QmhCLEtBQXpCO0FBQ0QsS0FGTSxDQUFQO0FBR0Q7O0FBRURpQixtQkFBaUI7QUFDZixTQUFLMUIsV0FBTCxDQUFpQjJCLE1BQWpCLENBQXdCLEtBQUsxQixXQUE3QjtBQUNEO0FBOUNvQztrQkFBbEJKLGlCIiwiZmlsZSI6IlNwaW5hbENhbEVuZHBvaW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgTW9kZWxcbn0gZnJvbSBcInNwaW5hbC1jb3JlLWNvbm5lY3RvcmpzX3R5cGVcIjtcblxuY29uc3Qge1xuICBkYXNoYm9hcmRWYXJpYWJsZXNcbn0gPSByZXF1aXJlKFwic3BpbmFsLWVudi12aWV3ZXItZGFzaGJvYXJkLXN0YW5kYXJkLXNlcnZpY2VcIik7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNwaW5hbENhbEVuZHBvaW50IHtcbiAgY29uc3RydWN0b3Iobm9kZSkge1xuICAgIHRoaXMubm9kZSA9IG5vZGU7XG5cbiAgICB0aGlzLm1vZGVsVG9CaW5kID0gbnVsbDtcbiAgICB0aGlzLmJpbmRQcm9jZXNzID0gbnVsbDtcbiAgfVxuXG4gIGJpbmRFbmRwb2ludChjYWxsYmFjaykge1xuICAgIHRoaXMubm9kZS5lbGVtZW50LmxvYWQoKS50aGVuKGVsZW1lbnQgPT4ge1xuXG4gICAgICB0aGlzLm1vZGVsVG9CaW5kID0gbmV3IE1vZGVsKHtcbiAgICAgICAgaW5mbzogdGhpcy5ub2RlLmluZm8sXG4gICAgICAgIHZhbHVlOiBlbGVtZW50LmN1cnJlbnRWYWx1ZVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuYmluZFByb2Nlc3MgPSB0aGlzLm1vZGVsVG9CaW5kLmJpbmQoY2FsbGJhY2spO1xuICAgIH0pLmNhdGNoKCgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMubm9kZSk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRDdXJyZW50VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMubm9kZS5lbGVtZW50LmxvYWQoKS50aGVuKGVsZW1lbnQgPT4ge1xuICAgICAgcmV0dXJuIGVsZW1lbnQuY3VycmVudFZhbHVlLmdldCgpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0UnVsZSgpIHtcbiAgICByZXR1cm4gdGhpcy5ub2RlLmluZm8uZGFzaF9jYWxfcnVsZSA/XG4gICAgICB0aGlzLm5vZGUuaW5mby5kYXNoX2NhbF9ydWxlLnJ1bGUuZ2V0KCkgOlxuICAgICAgZGFzaGJvYXJkVmFyaWFibGVzLkNBTENVTEFUSU9OX1JVTEVTLmF2ZXJhZ2U7XG4gIH1cblxuICBnZXRSZWZlcmVuY2UoKSB7XG4gICAgcmV0dXJuIHRoaXMubm9kZS5pbmZvLmRhc2hfY2FsX3J1bGUucmVmLmdldCgpO1xuICB9XG5cbiAgc2V0RW5kcG9pbnQodmFsdWUpIHtcbiAgICByZXR1cm4gdGhpcy5ub2RlLmVsZW1lbnQubG9hZCgpLnRoZW4oZWxlbWVudCA9PiB7XG4gICAgICBlbGVtZW50LmN1cnJlbnRWYWx1ZS5zZXQodmFsdWUpO1xuICAgIH0pO1xuICB9XG5cbiAgdW5iaW5kRW5kcG9pbnQoKSB7XG4gICAgdGhpcy5tb2RlbFRvQmluZC51bmJpbmQodGhpcy5iaW5kUHJvY2Vzcyk7XG4gIH1cbn0iXX0=